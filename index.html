<!DOCTYPE html>
<html lang="pt">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<meta name="apple-mobile-web-app-title" content="Finan√ßas">
<link rel="apple-touch-icon" href="icon.png">
<link rel="manifest" href="manifest.json">
<title>Finan√ßas</title>
<style>
body {margin:0;font-family:-apple-system,system-ui,sans-serif;background:#f5f5f5;color:#333;display:flex;flex-direction:column;height:100vh;overflow:hidden;}
header{padding:1rem;text-align:center;font-weight:600;background:#007aff;color:#fff;}
main{flex:1;overflow-y:auto;padding:1rem;}
.saldo{font-size:1.5rem;text-align:center;margin-bottom:1rem;}
.conta{background:#fff;padding:.8rem 1rem;border-radius:12px;margin-bottom:.5rem;display:flex;justify-content:space-between;align-items:center;box-shadow:0 2px 5px rgba(0,0,0,0.05);}
.btn{background:#007aff;color:white;border:none;border-radius:12px;padding:.8rem 1rem;font-size:1rem;width:100%;margin-top:1rem;}
form{background:#fff;padding:1rem;border-radius:12px;margin:1rem 0;}
input,select{width:100%;padding:.6rem;margin:.3rem 0;border-radius:6px;border:1px solid #ccc;}
/* Bottom Menu */
footer{display:flex;justify-content:space-around;padding:.5rem 0;background:#fff;border-top:1px solid #ddd;box-shadow:0 -2px 5px rgba(0,0,0,0.05);}
footer button{background:none;border:none;font-size:1rem;color:#007aff;display:flex;flex-direction:column;align-items:center;justify-content:center;}
footer button span{font-size:.7rem;color:#555;}
</style>
</head>
<body>

<header>üí∞ Finan√ßas</header>
<main id="mainView">
  <div id="saldos"></div>
  <form id="formulario" style="display:none;">
    <select id="tipo">
      <option>Despesa</option>
      <option>Receita</option>
      <option>Transfer√™ncia</option>
    </select>
    <input id="origem" placeholder="Conta Origem">
    <input id="destino" placeholder="Conta Destino (Transfer√™ncia)">
    <input id="valor" type="number" step="0.01" placeholder="Valor (‚Ç¨)">
    <input id="descricao" placeholder="Descri√ß√£o">
    <button type="button" class="btn" onclick="enviarTransacao()">Guardar</button>
  </form>
</main>

<footer>
  <button onclick="mostrarHome()">üè†<span>Home</span></button>
  <button onclick="mostrarFormulario()">‚ûï<span>Nova</span></button>
  <button onclick="verMovimentos()">üìÑ<span>Movs</span></button>
</footer>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbxa9OH_WQjrhlT4ma2REjyana0KxxLH0z0Xr30kC0h5WBzr-Cd3siltQGL5FbWYQjtn/exec";

async function carregarSaldos() {
  try {
    const res = await fetch(`${API_URL}?action=getaccounts`);
    const data = await res.json();
    const container = document.getElementById('saldos');
    container.innerHTML = '';
    if (!data.ok || !data.accounts) return;
    let total = 0;
    data.accounts.forEach(c=>{
      total += Number(c.SaldoAtual||0);
      const div = document.createElement('div');
      div.className = 'conta';
      div.innerHTML = `<span>${c.Conta}</span><span>${Number(c.SaldoAtual).toFixed(2)} ‚Ç¨</span>`;
      container.appendChild(div);
    });
    const saldoTotal = document.createElement('div');
    saldoTotal.className='saldo';
    saldoTotal.innerHTML = `Saldo Total: <b>${total.toFixed(2)} ‚Ç¨</b>`;
    container.prepend(saldoTotal);
  } catch(e){ console.error(e);}
}

function mostrarFormulario() { document.getElementById('formulario').style.display='block'; }
function mostrarHome() { document.getElementById('formulario').style.display='none'; carregarSaldos(); }

async function verMovimentos() {
  try {
    const res = await fetch(`${API_URL}?action=getmovements&limit=50`);
    const data = await res.json();
    const container = document.getElementById('saldos');
    container.innerHTML='<h3>√öltimos Movimentos</h3>';
    data.movements.forEach(m=>{
      const div=document.createElement('div');
      div.className='conta';
      div.innerHTML=`<span>${m.Descricao||m.Tipo}</span><span>${Number(m.Valor).toFixed(2)} ‚Ç¨</span>`;
      container.appendChild(div);
    });
  } catch(e){ console.error(e);}
}

async function enviarTransacao() {
  const payload={
    Tipo: document.getElementById('tipo').value,
    ContaOrigem: document.getElementById('origem').value,
    ContaDestino: document.getElementById('destino').value,
    Valor: Number(document.getElementById('valor').value),
    Descricao: document.getElementById('descricao').value
  };
  try{
    const res = await fetch(API_URL,{
      method:'POST',
      body: JSON.stringify({action:'addTransaction', payload}),
      headers:{'Content-Type':'application/json'}
    });
    const data = await res.json();
    if(data.ok) mostrarHome();
    else alert('Erro: '+(data.error||''));
  }catch(e){ alert('Erro ao guardar'); }
}

carregarSaldos();
</script>
</body>
</html>
