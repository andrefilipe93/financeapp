<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>FinanÃ§as Pessoais</title>
  <style>
    body { font-family: -apple-system, sans-serif; margin: 0; background: #f5f5f5; color: #333; }
    header { background: #fff; padding: 1rem; text-align: center; font-size: 1.2rem; font-weight: bold; box-shadow: 0 2px 4px rgba(0,0,0,0.1);}
    main { padding: 1rem; max-width: 600px; margin: auto; }
    .saldo { text-align: center; margin: 1rem 0; font-size: 1.5rem; }
    .conta { background: white; padding: .8rem 1rem; border-radius: 10px; margin-bottom: .6rem; display: flex; justify-content: space-between; align-items: center; }
    .btn { background: #007aff; color: white; border: none; border-radius: 10px; padding: .7rem 1rem; font-size: 1rem; width: 100%; margin-top: 1rem; }
    form { background: white; padding: 1rem; border-radius: 10px; margin-top: 1rem; }
    input, select { width: 100%; padding: .6rem; margin: .3rem 0; border-radius: 6px; border: 1px solid #ccc; }
  </style>
</head>
<body>
  <header>ðŸ’° FinanÃ§as</header>
  <main>
    <div id="saldos"></div>
    <button class="btn" onclick="mostrarFormulario()">âž• Nova TransaÃ§Ã£o</button>

    <form id="formulario" style="display:none;">
      <select id="tipo">
        <option value="Receita">Receita</option>
        <option value="Despesa">Despesa</option>
        <option value="TransferÃªncia">TransferÃªncia</option>
      </select>
      <input id="origem" placeholder="Conta origem">
      <input id="destino" placeholder="Conta destino (se transferÃªncia)">
      <input id="valor" placeholder="Valor (â‚¬)" type="number" step="0.01">
      <input id="descricao" placeholder="DescriÃ§Ã£o">
      <button type="button" class="btn" onclick="enviarTransacao()">Guardar</button>
    </form>
  </main>

  <script>
    const API_URL = "https://script.google.com/macros/s/AKfycbxwj6ku-C-7TUn8YFRGmddWYb6zrxQtGuDYG071mMK08EHuzIbGb8t2BOCp-rYwlwE/exec";

    async function carregarSaldos() {
      const res = await fetch(API_URL + '?action=getData');
      const data = await res.json();
      const contas = data.contas;
      const container = document.getElementById('saldos');
      container.innerHTML = `<div class='saldo'>Saldo total: <b>${data.total.toFixed(2)} â‚¬</b></div>`;
      contas.forEach(c => {
        const div = document.createElement('div');
        div.className = 'conta';
        div.innerHTML = `<span>${c.Conta}</span><span><b>${parseFloat(c.SaldoAtual).toFixed(2)} â‚¬</b></span>`;
        container.appendChild(div);
      });
    }

    function mostrarFormulario() {
      document.getElementById('formulario').style.display = 'block';
    }

    async function enviarTransacao() {
      const tipo = document.getElementById('tipo').value;
      const origem = document.getElementById('origem').value;
      const destino = document.getElementById('destino').value;
      const valor = document.getElementById('valor').value;
      const descricao = document.getElementById('descricao').value;

      await fetch(API_URL + '?action=addTransaction', {
        method: 'POST',
        body: JSON.stringify({ tipo, origem, destino, valor, descricao }),
        headers: { 'Content-Type': 'application/json' }
      });

      document.getElementById('formulario').reset();
      document.getElementById('formulario').style.display = 'none';
      carregarSaldos();
    }

    carregarSaldos();
  </script>
</body>
</html>
